apiVersion: v1
items:
- apiVersion: v1
  data:
    apicast-policy.json: ewogICIkc2NoZW1hIjogImh0dHA6Ly9hcGljYXN0LmlvL3BvbGljeS12MS4xL3NjaGVtYSNtYW5pZmVzdCMiLAogICJuYW1lIjogIkV4dGVybmFsIFNlcnZpY2UgQXV0aG9yaXphdGlvbiIsCiAgInN1bW1hcnkiOiAiVmFsaWRhdGVzIHRoZSByZXF1ZXN0IGFnYWluc3QgYW4gZXh0ZXJuYWwgc2VydmljZSIsCiAgImRlc2NyaXB0aW9uIjogWwogICAgIlZhbGlkYXRlcyB0aGUgcmVxdWVzdCBhZ2FpbnN0IGFuIGV4dGVybmFsIHNlcnZpY2UuIgogIF0sCiAgInZlcnNpb24iOiAiMC4xIiwKICAiY29uZmlndXJhdGlvbiI6IHsKICAgICJ0eXBlIjogIm9iamVjdCIsCiAgICAicHJvcGVydGllcyI6IHsKICAgICAgInZhbGlkYXRpb25fc2VydmljZV9jb25maWd1cmF0aW9uIjoKICAgICAgewogICAgICAgICJ0eXBlIjoib2JqZWN0IiwKICAgICAgICAiZGVzY3JpcHRpb24iOiJjbGllbnQgY29uZmlndXJhdGlvbiBmb3IgdmFsaWRhdGlvbiBzZXJ2aWNlIGNhbGwiLAogICAgICAgICJwcm9wZXJ0aWVzIjoKICAgICAgICB7CiAgICAgICAgICAidmFsaWRhdGlvbl9zZXJ2aWNlX3VybCI6IHsKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogInVybCBmb3IgcmVtb3RlIHZhbGlkYXRpb24gc2VydmljZSIsCiAgICAgICAgICAgICJ0eXBlIjogInN0cmluZyIKICAgICAgICAgIH0sCiAgICAgICAgICAidmFsaWRhdGlvbl9zZXJ2aWNlX21ldGhvZCI6IHsKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogImh0dHAgbWV0aG9kIGZvciBpbnZva2luZyBmb3IgcmVtb3RlIHZhbGlkYXRpb24gc2VydmljZSAiLAogICAgICAgICAgICAidHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgICAiZGVmYXVsdCI6ICJQT1NUIiwKICAgICAgICAgICAgImVudW0iOiBbCiAgICAgICAgICAgICAgIkdFVCIsCiAgICAgICAgICAgICAgIlBPU1QiCiAgICAgICAgICAgIF0KICAgICAgICAgIH0sCiAgICAgICAgICAiYWxsb3dlZF9zdGF0dXNfY29kZXMiOgogICAgICAgICAgewogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiJzdGF0dXMgY29kZXMgdG8gYmUgcmV0dXJuZWQgdG8gdGhlIGNsaWVudCwgaWYgZW1wdHkgcmV0dXJuIGV2ZXJ5IHJlc3BvbnNlIGFzLWlzLCBpZiBzcGVjaWZpZWQgZXZlcnkgbm9uLW1hdGNoaW5nIGNvZGUgaXMgdHJhbnNsYXRlZCBpbnRvIGEgNTAwLCBhIEhUVFAgMjAwIGFsd2F5cyByZXR1cm5zIE9LIiwKICAgICAgICAgICAgInR5cGUiOiAiYXJyYXkiLAogICAgICAgICAgICAiaXRlbXMiOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgInR5cGUiOiJpbnRlZ2VyIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgInZhbGlkYXRpb25fc2VydmljZV9wYXJhbXMiOiB7CiAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJwYXJhbWV0ZXJzIGZvciByZW1vdGUgdmFsaWRhdGlvbiBzZXJ2aWNlIiwKICAgICAgICAgICAgInR5cGUiOiAiYXJyYXkiLAogICAgICAgICAgICAiaXRlbXMiOiB7CiAgICAgICAgICAgICAgInR5cGUiOiAib2JqZWN0IiwKICAgICAgICAgICAgICAicHJvcGVydGllcyI6IHsKICAgICAgICAgICAgICAgICJwYXJhbSI6IHsKICAgICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogIk5hbWUgb2YgdGhlIHBhcmFtZXRlciB0byBiZSBhZGRlZCIsCiAgICAgICAgICAgICAgICAgICJ0eXBlIjogInN0cmluZyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidmFsdWUiOiB7CiAgICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJWYWx1ZSB0aGF0IHdpbGwgYmUgc2V0IGluIHRoZSBwYXJhbWV0ZXIuIiwKICAgICAgICAgICAgICAgICAgInR5cGUiOiAic3RyaW5nIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ2YWx1ZV90eXBlIjogewogICAgICAgICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiSG93IHRvIGV2YWx1YXRlICd2YWx1ZSciLAogICAgICAgICAgICAgICAgICAidHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgICAgICAgICAib25lT2YiOiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgImVudW0iOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICJwbGFpbiIKICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgICAidGl0bGUiOiAiRXZhbHVhdGUgJ3ZhbHVlJyBhcyBwbGFpbiB0ZXh0LiIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICJlbnVtIjogWwogICAgICAgICAgICAgICAgICAgICAgICAibGlxdWlkIgogICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJFdmFsdWF0ZSAndmFsdWUnIGFzIGxpcXVpZC4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAiZGVmYXVsdCI6ICJwbGFpbiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJyZXF1aXJlZCI6IFsKICAgICAgICAgICAgICAgICJwYXJhbSIKICAgICAgICAgICAgICBdCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAidmFsaWRhdGlvbl9zZXJ2aWNlX3RpbWVvdXRzIjogewogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAidGltZW91dCBmb3IgdmFsaWRhdGlvbiBzZXJ2aWNlIGNhbGwiLAogICAgICAgICAgICAidHlwZSI6ICJvYmplY3QiLAogICAgICAgICAgICAicHJvcGVydGllcyI6IHsKICAgICAgICAgICAgICAiY29ubmVjdF90aW1lb3V0IjogewogICAgICAgICAgICAgICAgInR5cGUiOiAiaW50ZWdlciIsCiAgICAgICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAidGltZW91dCBmb3IgdmFsaWRhdGlvbiBzZXJ2aWNlIGNvbm5lY3Rpb24iLAogICAgICAgICAgICAgICAgIm1pbmltdW0iOiAtMSwKICAgICAgICAgICAgICAgICJtYXhpbXVtIjogMzYwMCwKICAgICAgICAgICAgICAgICJkZWZhdWx0IjogNTAwCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAicmVxdWVzdF90aW1lb3V0IjogewogICAgICAgICAgICAgICAgInR5cGUiOiAiaW50ZWdlciIsCiAgICAgICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAidGltZW91dCBmb3IgdmFsaWRhdGlvbiBzZXJ2aWNlIHJlcXVlc3QiLAogICAgICAgICAgICAgICAgIm1pbmltdW0iOiAtMSwKICAgICAgICAgICAgICAgICJtYXhpbXVtIjogMzYwMCwKICAgICAgICAgICAgICAgICJkZWZhdWx0IjogNTAwCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAicmVzcG9uc2VfdGltZW91dCI6IHsKICAgICAgICAgICAgICAgICJ0eXBlIjogImludGVnZXIiLAogICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogInRpbWVvdXQgZm9yIHZhbGlkYXRpb24gc2VydmljZSByZXNwb25zZSIsCiAgICAgICAgICAgICAgICAibWluaW11bSI6IC0xLAogICAgICAgICAgICAgICAgIm1heGltdW0iOiAzNjAwLAogICAgICAgICAgICAgICAgImRlZmF1bHQiOiA1MDAKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgICJyZXF1aXJlZCI6IFsKICAgICAgICAgICJ2YWxpZGF0aW9uX3NlcnZpY2VfdXJsIgogICAgICAgIF0KICAgICAgfSwKICAgICAgImhlYWRlcnNfY29uZmlndXJhdGlvbiI6CiAgICAgIHsKICAgICAgICAidHlwZSI6Im9iamVjdCIsCiAgICAgICAgImRlc2NyaXB0aW9uIjoiaGVhZGVycyB0byBiZSBwYXNzZWQgdG8gdmFsaWRhdGlvbiBzZXJ2aWNlIiwKICAgICAgICAicHJvcGVydGllcyI6CiAgICAgICAgewogICAgICAgICAgImhlYWRlcnNfdG9fY29weSI6IHsKICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogImhlYWRlcnMgdG8gYmUgY29waWVkIHRvIHRoZSByZW1vdGUgc2VydmljZSIsCiAgICAgICAgICAgICJ0eXBlIjogInN0cmluZyIsCiAgICAgICAgICAgICJlbnVtIjogWwogICAgICAgICAgICAgICJBTEwiLAogICAgICAgICAgICAgICJTZWxlY3RlZCBIZWFkZXJzIiwKICAgICAgICAgICAgICAiTm9uZSIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgImRlZmF1bHQiOiAiQUxMIgogICAgICAgICAgfSwKICAgICAgICAgICJhZGRpdGlvbmFsX2hlYWRlcnMiOiB7CiAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJoZWFkZXJzIHRvIGJlIGFkZGVkIHRvIHRoZSByZW1vdGUgc2VydmljZSBjYWxsLCBpZiBzcGVjaWZpZWQgd2lsbCBvdmVycmlkZSB0aGUgY29waWVkIG9uZXMiLAogICAgICAgICAgICAidHlwZSI6ICJhcnJheSIsCiAgICAgICAgICAgICJpdGVtcyI6IHsKICAgICAgICAgICAgICAidHlwZSI6ICJvYmplY3QiLAogICAgICAgICAgICAgICJwcm9wZXJ0aWVzIjogewogICAgICAgICAgICAgICAgImhlYWRlciI6IHsKICAgICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogIkhlYWRlciB0byBiZSBhZGRlZCIsCiAgICAgICAgICAgICAgICAgICJ0eXBlIjogInN0cmluZyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAidmFsdWUiOiB7CiAgICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJWYWx1ZSB0aGF0IHdpbGwgYmUgc2V0IGluIHRoZSBoZWFkZXIuIiwKICAgICAgICAgICAgICAgICAgInR5cGUiOiAic3RyaW5nIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ2YWx1ZV90eXBlIjogewogICAgICAgICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiSG93IHRvIGV2YWx1YXRlICd2YWx1ZSciLAogICAgICAgICAgICAgICAgICAidHlwZSI6ICJzdHJpbmciLAogICAgICAgICAgICAgICAgICAib25lT2YiOiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgImVudW0iOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICJwbGFpbiIKICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgICAidGl0bGUiOiAiRXZhbHVhdGUgJ3ZhbHVlJyBhcyBwbGFpbiB0ZXh0LiIKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICJlbnVtIjogWwogICAgICAgICAgICAgICAgICAgICAgICAibGlxdWlkIgogICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJFdmFsdWF0ZSAndmFsdWUnIGFzIGxpcXVpZC4iCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAiZGVmYXVsdCI6ICJwbGFpbiIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJyZXF1aXJlZCI6IFsKICAgICAgICAgICAgICAgICJoZWFkZXIiCiAgICAgICAgICAgICAgXQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICAiZGVwZW5kZW5jaWVzIjogewogICAgICAgICAgImhlYWRlcnNfdG9fY29weSI6IHsKICAgICAgICAgICAgIm9uZU9mIjogWwogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJwcm9wZXJ0aWVzIjogewogICAgICAgICAgICAgICAgICAiaGVhZGVyc190b19jb3B5IjogewogICAgICAgICAgICAgICAgICAgICJkZXNjcmliZSI6ICJTZW5kIEFMTCB0aGUgcmVjZWl2ZWQgaGVhZGVycyB0byB0aGUgYXV0aG9yaXphdGlvbiBzZXJ2aWNlLiIsCiAgICAgICAgICAgICAgICAgICAgImVudW0iOiBbCiAgICAgICAgICAgICAgICAgICAgICAiQUxMIgogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgInByb3BlcnRpZXMiOiB7CiAgICAgICAgICAgICAgICAgICJoZWFkZXJzX3RvX2NvcHkiOiB7CiAgICAgICAgICAgICAgICAgICAgImRlc2NyaWJlIjogIkRvbid0IHNlbmQgdGhlIHJlY2VpdmVkIGhlYWRlcnMgdG8gdGhlIGF1dGhvcml6YXRpb24gc2VydmljZS4iLAogICAgICAgICAgICAgICAgICAgICJlbnVtIjogWwogICAgICAgICAgICAgICAgICAgICAgIk5vbmUiCiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAicHJvcGVydGllcyI6IHsKICAgICAgICAgICAgICAgICAgImhlYWRlcnNfdG9fY29weSI6IHsKICAgICAgICAgICAgICAgICAgICAiZGVzY3JpYmUiOiAiU2VuZCBPTkxZIFNFTEVDVEVEIGhlYWRlcnMgdG8gdGhlIGF1dGhvcml6YXRpb24gc2VydmljZS4iLAogICAgICAgICAgICAgICAgICAgICJlbnVtIjogWwogICAgICAgICAgICAgICAgICAgICAgIlNlbGVjdGVkIEhlYWRlcnMiCiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAic2VsZWN0ZWRfaGVhZGVycyI6IHsKICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJhcnJheSIsCiAgICAgICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogImxpc3Qgb2YgdGhlIGhlYWRlcnMgdG8gYmUgY29waWVkIiwKICAgICAgICAgICAgICAgICAgICAiaXRlbXMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJvYmplY3QiLAogICAgICAgICAgICAgICAgICAgICAgInByb3BlcnRpZXMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJoZWFkZXJfbmFtZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAiZGVzY3JpcHRpb24iOiAiSGVhZGVyIHRvIGJlIGNvcGllZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAic3RyaW5nIgogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAiYWN0aW9uX2lmX21pc3NpbmciOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgImRlc2NyaXB0aW9uIjogIlRoZSBhY3Rpb24gdG8gYmUgcGVyZm9ybWVkIGlmIHRoZSBnaXZlbiBoZWFkZXIgaXMgbWlzc2luZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAic3RyaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAiZGVmYXVsdCI6ICJJZ25vcmUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICJlbnVtIjogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIklnbm9yZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiU2V0IEVtcHR5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJGYWlsIgogICAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICJyZXF1aXJlZCI6IFsKICAgICAgICAgICAgICAgICAgICAgICAgImFjdGlvbl9pZl9taXNzaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgImhlYWRlcl9uYW1lIgogICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAgICJkZXBlbmRlbmNpZXMiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJhY3Rpb25faWZfbWlzc2luZyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAib25lT2YiOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwcm9wZXJ0aWVzIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhY3Rpb25faWZfbWlzc2luZyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkZXNjcmliZSI6ICJJZiB0aGUgaGVhZGVyIGlzIG1pc3NpbmcsIGlnbm9yZSBpdCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZW51bSI6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIklnbm9yZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwcm9wZXJ0aWVzIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhY3Rpb25faWZfbWlzc2luZyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkZXNjcmliZSI6ICJJZiB0aGUgaGVhZGVyIGlzIG1pc3NpbmcsIHNldCBpdCBlbXB0eSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZW51bSI6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIlNldCBFbXB0eSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwcm9wZXJ0aWVzIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJhY3Rpb25faWZfbWlzc2luZyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkZXNjcmliZSI6ICJJZiB0aGUgaGVhZGVyIGlzIG1pc3NpbmcsIGZhaWxzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJlbnVtIjogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRmFpbCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJodHRwX3N0YXR1cyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkZWZhdWx0IjogIjQwMSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJzdHJpbmciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibWVzc2FnZSI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6ICJNZXNzYWdlIHRvIGJlIHJldHVybmVkIHRvIHRoZSBjbGllbnQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAic3RyaW5nIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInJlcXVpcmVkIjogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJodHRwX3N0YXR1cyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfQo=
    external_auth_service.lua: LS0gRXh0ZXJuYWwgQXV0aG9yaXphdGlvbiBTZXJ2aWNlIHBvbGljeQotLSBpbnZva2VzIGFuIGV4dGVybmFsIHNlcnZpY2UgZm9yIGF1dGhvcml6YXRpb24uCgoKLS0gbG9jYWwgZnVuY3Rpb24gYWxpYXNlcwoKbG9jYWwgaXBhaXJzID0gaXBhaXJzCmxvY2FsIHRvbnVtYmVyID0gdG9udW1iZXIKbG9jYWwgVGVtcGxhdGVTdHJpbmcgPSByZXF1aXJlICdhcGljYXN0LnRlbXBsYXRlX3N0cmluZycKbG9jYWwgX00gPSByZXF1aXJlKCdhcGljYXN0LnBvbGljeScpLm5ldygnRXh0ZXJuYWwgU2VydmljZSBBdXRob3JpemF0aW9uJykKbG9jYWwgY2pzb24gPSByZXF1aXJlKCdjanNvbicpCmxvY2FsIG5ldyA9IF9NLm5ldwpsb2NhbCByZXN0eV9lbnYgPSByZXF1aXJlKCdyZXN0eS5lbnYnKQoKLS0gSFRUUCBjbGllbnQKbG9jYWwgaHR0cCA9IHJlcXVpcmUoJ3Jlc3R5Lmh0dHAnKQoKCgotLSBkZWZhdWx0IHZhbHVlcwoKbG9jYWwgZGVmYXVsdF92YWx1ZV90eXBlID0gJ3BsYWluJyAtLSBkZWZhdWx0IHR5cGUgZm9yIHRlbXBsYXRlIHByb2Nlc3NpbmcKbG9jYWwgZGVmYXVsdF92YWxpZGF0aW9uX3NlcnZpY2VfbWV0aG9kID0gJ1BPU1QnIC0tIGRlZmF1bHQgaHR0cCBtZXRob2QgZm9yIGF1dGhvcml6YXRpb24gc2VydmljZSBpbnZvY2F0aW9uCmxvY2FsIGRlZmF1bHRfbWlzc2luZ19oZWFkZXJfc3RhdHVzID0gNDAxIC0tIGRlZmF1bHQgSFRUUCBzdGF0dXMgY29kZSBmb3IgZGVueWluZyBieSBtaXNzaW5nIGhlYWRlciAKbG9jYWwgZGVmYXVsdF9taXNzaW5nX2hlYWRlcl9tZXNzYWdlID0gIm1hbmRhdG9yeSBoZWFkZXIgaXMgbWlzc2luZyIgLS0gZGVmYXVsdCBIVFRQIG1lc3NhZ2UgZm9yIGRlbnlpbmcgYnkgbWlzc2luZyBoZWFkZXIgCmxvY2FsIGRlZmF1bHRfc2VydmljZV90aW1lb3V0ID0gNTAwIC0tIGRlZmF1bHQgdGltZW91dCAoaW4gbWlsbGlzZWNvbmRzKQoKLS0gbG9nTGV2ZWxzCgpsb2NhbCBERUJVRyA9IG5neC5ERUJVRwpsb2NhbCBJTkZPID0gbmd4LklORk8KbG9jYWwgV0FSTiA9IG5neC5XQVJOCmxvY2FsIEVSUk9SID0gbmd4LkVSUgoKLS0tIGZ1bmN0aW9uIGhhc192YWx1ZTogY2hlY2sgaWYgdGhlIGdpdmVuIHZhbHVlIGlzIHByZXNlbnQgaW5zaWRlIGEgdGFibGUgCi0tLQotLS1AcGFyYW0gdGFiIGFueSBAdGhlIHRhYmxlIHRvIGNoZWNrCi0tLUBwYXJhbSB2YWwgYW55IEB0aGUgdmFsdWUgdG8gZmluZAotLS1AcmV0dXJuIGJvb2xlYW4gQHRydWUgaWYgdmFsdWUgaXMgcHJlc2VudAotLS0KCmxvY2FsIGZ1bmN0aW9uIGhhc192YWx1ZSAodGFiLCB2YWwpCiAgICBmb3IgaW5kZXgsIHZhbHVlIGluIGlwYWlycyh0YWIpIGRvCiAgICAgICAgaWYgdmFsdWUgPT0gdmFsIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHJldHVybiBmYWxzZQplbmQKCgoKLS0tIGlmIEFQSUNBU1RfTE9HX0xFVkVMIGlzIHNldCB0byBERUJVRyBwcmludHMgdGhlIGNvbnRlbnQgb2YgdGhlIGdpdmVuIHRhYmxlCi0tLUBwYXJhbSBub2RlIHRhYmxlIEAgdGhlIHRhYmxlIHRvIGJlIHByaW50ZWQKLS0tCgpsb2NhbCBmdW5jdGlvbiBwcmludF90YWJsZShub2RlKQoKICAgIC0tIGlmIEFQSUNBU1RfTE9HX0xFVkVMIGlzIG5vdCBERUJVRyBza2lwCiAgICBpZiByZXN0eV9lbnYuZ2V0KCJBUElDQVNUX0xPR19MRVZFTCIpIH49ICJkZWJ1ZyIgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgbG9jYWwgY2FjaGUsIHN0YWNrLCBvdXRwdXQgPSB7fSwge30sIHt9CiAgICBsb2NhbCBkZXB0aCA9IDEKICAgIGxvY2FsIG91dHB1dF9zdHIgPSAie1xuIgoKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICBsb2NhbCBzaXplID0gMAogICAgICAgIGZvciBrLCB2IGluIHBhaXJzKG5vZGUpIGRvCiAgICAgICAgICAgIHNpemUgPSBzaXplICsgMQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBjdXJfaW5kZXggPSAxCiAgICAgICAgZm9yIGssIHYgaW4gcGFpcnMobm9kZSkgZG8KICAgICAgICAgICAgaWYgKGNhY2hlW25vZGVdID09IG5pbCkgb3IgKGN1cl9pbmRleCA+PSBjYWNoZVtub2RlXSkgdGhlbgoKICAgICAgICAgICAgICAgIGlmIChzdHJpbmcuZmluZChvdXRwdXRfc3RyLCAifSIsIG91dHB1dF9zdHI6bGVuKCkpKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0X3N0ciA9IG91dHB1dF9zdHIgLi4gIixcbiIKICAgICAgICAgICAgICAgIGVsc2VpZiBub3QgKHN0cmluZy5maW5kKG91dHB1dF9zdHIsICJcbiIsIG91dHB1dF9zdHI6bGVuKCkpKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0X3N0ciA9IG91dHB1dF9zdHIgLi4gIlxuIgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgLS0gVGhpcyBpcyBuZWNlc3NhcnkgZm9yIHdvcmtpbmcgd2l0aCBIVUdFIHRhYmxlcyBvdGhlcndpc2Ugd2UgcnVuIG91dCBvZiBtZW1vcnkgdXNpbmcgY29uY2F0IG9uIGh1Z2Ugc3RyaW5ncwogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KG91dHB1dCwgb3V0cHV0X3N0cikKICAgICAgICAgICAgICAgIG91dHB1dF9zdHIgPSAiIgoKICAgICAgICAgICAgICAgIGxvY2FsIGtleQogICAgICAgICAgICAgICAgaWYgKHR5cGUoaykgPT0gIm51bWJlciIgb3IgdHlwZShrKSA9PSAiYm9vbGVhbiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBrZXkgPSAiWyIgLi4gdG9zdHJpbmcoaykgLi4gIl0iCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAga2V5ID0gIlsnIiAuLiB0b3N0cmluZyhrKSAuLiAiJ10iCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiAodHlwZSh2KSA9PSAibnVtYmVyIiBvciB0eXBlKHYpID09ICJib29sZWFuIikgdGhlbgogICAgICAgICAgICAgICAgICAgIG91dHB1dF9zdHIgPSBvdXRwdXRfc3RyIC4uIHN0cmluZy5yZXAoJ1x0JywgZGVwdGgpIC4uIGtleSAuLiAiID0gIiAuLiB0b3N0cmluZyh2KQogICAgICAgICAgICAgICAgZWxzZWlmICh0eXBlKHYpID09ICJ0YWJsZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBvdXRwdXRfc3RyID0gb3V0cHV0X3N0ciAuLiBzdHJpbmcucmVwKCdcdCcsIGRlcHRoKSAuLiBrZXkgLi4gIiA9IHtcbiIKICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoc3RhY2ssIG5vZGUpCiAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHN0YWNrLCB2KQogICAgICAgICAgICAgICAgICAgIGNhY2hlW25vZGVdID0gY3VyX2luZGV4ICsgMQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0X3N0ciA9IG91dHB1dF9zdHIgLi4gc3RyaW5nLnJlcCgnXHQnLCBkZXB0aCkgLi4ga2V5IC4uICIgPSAnIiAuLiB0b3N0cmluZyh2KSAuLiAiJyIKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGlmIChjdXJfaW5kZXggPT0gc2l6ZSkgdGhlbgogICAgICAgICAgICAgICAgICAgIG91dHB1dF9zdHIgPSBvdXRwdXRfc3RyIC4uICJcbiIgLi4gc3RyaW5nLnJlcCgnXHQnLCBkZXB0aCAtIDEpIC4uICJ9IgogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIG91dHB1dF9zdHIgPSBvdXRwdXRfc3RyIC4uICIsIgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIC0tIGNsb3NlIHRoZSB0YWJsZQogICAgICAgICAgICAgICAgaWYgKGN1cl9pbmRleCA9PSBzaXplKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0X3N0ciA9IG91dHB1dF9zdHIgLi4gIlxuIiAuLiBzdHJpbmcucmVwKCdcdCcsIGRlcHRoIC0gMSkgLi4gIn0iCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBjdXJfaW5kZXggPSBjdXJfaW5kZXggKyAxCiAgICAgICAgZW5kCgogICAgICAgIGlmIChzaXplID09IDApIHRoZW4KICAgICAgICAgICAgb3V0cHV0X3N0ciA9IG91dHB1dF9zdHIgLi4gIlxuIiAuLiBzdHJpbmcucmVwKCdcdCcsIGRlcHRoIC0gMSkgLi4gIn0iCiAgICAgICAgZW5kCgogICAgICAgIGlmICgjc3RhY2sgPiAwKSB0aGVuCiAgICAgICAgICAgIG5vZGUgPSBzdGFja1sjc3RhY2tdCiAgICAgICAgICAgIHN0YWNrWyNzdGFja10gPSBuaWwKICAgICAgICAgICAgZGVwdGggPSBjYWNoZVtub2RlXSA9PSBuaWwgYW5kIGRlcHRoICsgMSBvciBkZXB0aCAtIDEKICAgICAgICBlbHNlCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLSBUaGlzIGlzIG5lY2Vzc2FyeSBmb3Igd29ya2luZyB3aXRoIEhVR0UgdGFibGVzIG90aGVyd2lzZSB3ZSBydW4gb3V0IG9mIG1lbW9yeSB1c2luZyBjb25jYXQgb24gaHVnZSBzdHJpbmdzCiAgICB0YWJsZS5pbnNlcnQob3V0cHV0LCBvdXRwdXRfc3RyKQogICAgb3V0cHV0X3N0ciA9IHRhYmxlLmNvbmNhdChvdXRwdXQpCgogICAgbmd4LmxvZyhERUJVRywgb3V0cHV0X3N0cikKZW5kCgotLS0gZnVuY3Rpb24gYnVpbGRfdGVtcGxhdGVzCi0tLSB0cmFzZm9ybSB0aGUgdmFsdWUgaW4gYSB0ZW1wbGF0ZSBvZiB0aGUgZ2l2ZW4gdHlwZSAobGlxdWlkIG9yIHBsYWluIHRleHQpCi0tLQotLS1AcGFyYW0gdGVtcGxhdGVzIHRhYmxlIEB0cmFzZm9ybSB0aGUgdmFsdWUgaW4gYSB0ZW1wbGF0ZSBvZiB0aGUgZ2l2ZW4gdHlwZSAobGlxdWlkIG9yIHBsYWluIHRleHQpCi0tLUByZXR1cm4gdGFibGUgQHRoZSByZXR1cm5lZCB0YWJsZSBpcyB0aGUgaW5wdXQgd2l0aCBhbiBhZGRpdGlvbmFsIHRlbXBsYXRlX3N0cmluZyBmb3IgZnVydGhlciBwcm9jZXNzaW5nCi0tLQoKbG9jYWwgZnVuY3Rpb24gYnVpbGRfdGVtcGxhdGVzKHRlbXBsYXRlcykKICAgIGZvciBfLCB0ZW1wbGF0ZSBpbiBpcGFpcnModGVtcGxhdGVzKSBkbwogICAgICAgIHRlbXBsYXRlLnRlbXBsYXRlX3N0cmluZyA9IFRlbXBsYXRlU3RyaW5nLm5ldyh0ZW1wbGF0ZS52YWx1ZSwgdGVtcGxhdGUudmFsdWVfdHlwZSBvciBkZWZhdWx0X3ZhbHVlX3R5cGUpCiAgICBlbmQKZW5kCgoKLS0tIGZ1bmN0aW9uIGludm9rZVNlcnZpY2UgLSBJbnZva2VzIGFuIGV4dGVybmFsIHNlcnZpY2UKLS0tIGNhbiBpbnZva2UgSFRUUCBHRVQgYW5kIFBPU1Qgc2VydmljZXMKLS0tIHdpdGggYSBHRVQgc2VydmljZXMgdGhlIGFyZ3Mgd2lsbCBiZSBhcHBlbmRlZCB0byB0aGUgcXVlcnlzdHJpbmcgCi0tLSB3aXRoIGEgUE9TVCBzZXJ2aWNlIHRoZSBhcmdzIHdpbGwgYmUgc2VudCBpbiBhIEpTT04gZm9ybWF0Ci0tLQotLS1AcGFyYW0gc2VydmljZVVybCBzdHJpbmcgQCB0aGUgVVJMIGZvciB0aGUgc2VydmljZSB0byBiZSBpbnZva2VkCi0tLUBwYXJhbSBhcmdzIHRhYmxlIEAgdGhlIHRhYmxlIGNvbnRhaW5pbmcgdGhlIGFyZ3VtZW50cyAKLS0tQHBhcmFtIGh0dHBNZXRob2Qgc3RyaW5nIEAgdGhlIEhUVFAgbWV0aG9kIChjYW4gYmUgR0VUIG9yIFBPU1QpCi0tLUBwYXJhbSBoZWFkZXJzIHRhYmxlIEAgdGhlIEhUVFAgSEVBREVSUyB0byBiZSBwYXNzZWQgdG8gdGhlIHJlbW90ZSBzZXJ2aWNlIAotLS1AcGFyYW0gdGltZW91dHMgdGFibGUgQCBhIHRhYmxlIGNvbnRhaW5pbmcgdGhlIGNvbm5lY3QsIHNlbmQgYW5kIHJlYWQgdGltZW91dCAtPiB7Y29ubmVjdF90aW1lb3V0ID0gNTAwLCBzZW5kX3RpbWVvdXQgPSA1MDAsIHJlYWRfdGltZW91dCA9IDUwMH0KLS0tQHJldHVybiBodHRwX3N0YXR1c19jb2RlOiBudW1iZXIsIGh0dHBfZXJyb3I6IHN0cmluZywganNvbl9ib2R5OiBzdHJpbmcgQCB0aGUgdmFsdWVzIHJldHVybmVkIGZyb20gdGhlIHNlcnZpY2UgaW52b2NhdGlvbgotLS0KCmxvY2FsIGZ1bmN0aW9uIGludm9rZVNlcnZpY2Uoc2VydmljZVVybCwgYXJncywgaHR0cE1ldGhvZCwgaGVhZGVycywgdGltZW91dHMpCiAgICAKICAgIC0tIGR1bXAgdGhlIGZ1bmN0aW9uIGludm9jYXRpb24gaW5mb3JtYXRpb25zCiAgICBuZ3gubG9nKERFQlVHLCAnLSBFeHRlcm5hbEF1dGhTZXJ2aWNlUG9saWN5IDogaW52b2tlU2VydmljZTogc2VydmljZVVybC0+Jywgc2VydmljZVVybCkKICAgIG5neC5sb2coREVCVUcsICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBpbnZva2VTZXJ2aWNlOiBhcmdzJykKICAgIAogICAgcHJpbnRfdGFibGUoYXJncykKICAgIAogICAgbmd4LmxvZyhERUJVRywgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IGludm9rZVNlcnZpY2U6IGh0dHBNZXRob2QtPicsIGh0dHBNZXRob2QpCiAgICBuZ3gubG9nKERFQlVHLCAnLSBFeHRlcm5hbEF1dGhTZXJ2aWNlUG9saWN5IDogaW52b2tlU2VydmljZTogaGVhZGVycycpCiAgICAKICAgIHByaW50X3RhYmxlKGhlYWRlcnMpCgogICAgbG9jYWwgaHR0cGMgPSBodHRwLm5ldygpCiAgICBsb2NhbCBodHRwX3N0YXR1c19jb2RlCiAgICBsb2NhbCBodHRwX2Vycm9yCiAgICBsb2NhbCBqc29uX2JvZHkKICAgIGxvY2FsIGZ1bGxBcGlVUkwKICAgIGxvY2FsIHBhcmFtcyA9IHt9CgogICAgaWYgaHR0cE1ldGhvZCA9PSAnR0VUJyB0aGVuCiAgICAgICAgCiAgICAgICAgaWYgYXJncyB0aGVuCiAgICAgICAgICAgIC0tIGNyZWF0aW5nIHRoZSBIVFRQIEdFVCBzZXJ2aWNlIHVyaSBhcHBlbmRpbmcgdGhlIGFyZ3VtZW50cwogICAgICAgICAgICBmdWxsQXBpVVJMID0gc2VydmljZVVybCAuLiAiPyIgLi4gYXJncyAuLiAiIgogICAgICAgIGVsc2UKICAgICAgICAgICAgZnVsbEFwaVVSTCA9IHNlcnZpY2VVcmwKICAgICAgICBlbmQKCiAgICBlbHNlaWYgaHR0cE1ldGhvZCA9PSAnUE9TVCcgdGhlbgogICAgICAgIAogICAgICAgIGZ1bGxBcGlVUkwgPSBzZXJ2aWNlVXJsCiAgICAgICAgbmd4LmxvZyhERUJVRywgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IGludm9rZVNlcnZpY2U6IGNyZWF0aW5nIGJvZHknKQogICAgICAgIGNqc29uLmVuY29kZV9lc2NhcGVfZm9yd2FyZF9zbGFzaChmYWxzZSkKICAgICAgICBwYXJhbXNbImJvZHkiXSA9IGNqc29uLmVuY29kZShhcmdzKQoKICAgIGVuZAogICAgCiAgICBuZ3gubG9nKERFQlVHLCAnLSBFeHRlcm5hbEF1dGhTZXJ2aWNlUG9saWN5IDogaW52b2tlU2VydmljZTogc2V0dGluZyBtZXRob2QsIGhlYWRlcnMgZXRjLi4nKQogICAgCiAgICBwYXJhbXNbIm1ldGhvZCJdID0gaHR0cE1ldGhvZAogICAgcGFyYW1zWyJoZWFkZXJzIl0gPSBoZWFkZXJzCiAgICBwYXJhbXNbInNzbF92ZXJpZnkiXSA9IHJlc3R5X2Vudi5lbmFibGVkKCdPUEVOU1NMX1ZFUklGWScpCiAgICAKICAgIG5neC5sb2coREVCVUcsICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBpbnZva2VTZXJ2aWNlOiBpbnZva2luZyBBUEkgYXQgdXJsLT4nLCBmdWxsQXBpVVJMKQogICAgbmd4LmxvZyhERUJVRywgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IGludm9rZVNlcnZpY2U6IGludm9raW5nIEFQSSB3aXRoIG1ldGhvZC0+JywgaHR0cE1ldGhvZCkKICAgIG5neC5sb2coREVCVUcsICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBpbnZva2VTZXJ2aWNlOiBpbnZva2luZyBBUEkgd2l0aCBwYXJhbXMtPicpCiAgICAKICAgIHByaW50X3RhYmxlKHBhcmFtcykKCiAgICBodHRwYzpzZXRfdGltZW91dHModGltZW91dHMuY29ubmVjdF90aW1lb3V0LCB0aW1lb3V0cy5zZW5kX3RpbWVvdXQsIHRpbWVvdXRzLnJlYWRfdGltZW91dCkKCiAgICAtLSBzZXJ2aWNlIGludm9jYXRpb24KICAgIGxvY2FsIHJlcywgZXJyID0gaHR0cGM6cmVxdWVzdF91cmkoZnVsbEFwaVVSTCwgcGFyYW1zKQogICAgCiAgICBpZiBlcnIgdGhlbgogICAgICAgIC0tIGFuIGVycm9yIG9jY3VycmVkIHdoaWxlIGludm9raW5nIHRoZSBzZXJ2aWNlLCByZXR1cm5pbmcgYSA1MDAgLSBpbnRlcm5hbCBzZXJ2ZXIgZXJyb3Igd2l0aCBlcnIgYXMgZGVzY3JpcHRpb24KICAgICAgICBuZ3gubG9nKFdBUk4sIGVycikKCiAgICAgICAgcmV0dXJuIDUwMCwgZXJyLCBuaWwgICAgCiAgICBlbmQKICAgIAogICAgLS0gc2VydmljZSBpbnZvY2F0aW9uIG9rLCBwcm9jZXNzaW5nIHRoZSByZXR1cm4gdmFsdWVzCgogICAgaHR0cF9zdGF0dXNfY29kZSA9IHJlcy5zdGF0dXMKICAgIGh0dHBfZXJyb3IgPSBlcnIgb3IgcmVzLnJlYXNvbgogICAganNvbl9ib2R5ID0gcmVzLmJvZHkKCiAgICAtLSBVc2UgcmVzLmJvZHkgdG8gYWNjZXNzIHRoZSByZXNwb25zZQogICAgLS0gV2hlbiB0aGUgcmVxdWVzdCBpcyBzdWNjZXNzZnVsLCByZXMgd2lsbCBjb250YWluIHRoZSBmb2xsb3dpbmcgZmllbGRzOgogICAgLS0gc3RhdHVzIFRoZSBzdGF0dXMgY29kZS4KICAgIC0tIHJlYXNvbiBUaGUgc3RhdHVzIHJlYXNvbiBwaHJhc2UuCiAgICAtLSBoZWFkZXJzIEEgdGFibGUgb2YgaGVhZGVycy4gTXVsdGlwbGUgaGVhZGVycyB3aXRoIHRoZSBzYW1lIGZpZWxkIG5hbWUgd2lsbCBiZSBwcmVzZW50ZWQgYXMgYSB0YWJsZSBvZiB2YWx1ZXMuCiAgICAtLSBib2R5IFRoZSByZXNwb25zZSBib2R5CiAgICBsb2NhbCBsb2dMZXZlbAogICAgaWYgKGh0dHBfc3RhdHVzX2NvZGUgPT0gMjAwKSB0aGVuCiAgICAgICAgbG9nTGV2ZWwgPSBERUJVRwogICAgZWxzZQogICAgICAgIGxvZ0xldmVsID0gV0FSTgogICAgZW5kCiAgICAKICAgIG5neC5sb2cobG9nTGV2ZWwsICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBpbnZva2VBUEk6IEFQSSBpbnZva2VkOiBodHRwX3N0YXR1c19jb2RlJywgaHR0cF9zdGF0dXNfY29kZSkKICAgIG5neC5sb2cobG9nTGV2ZWwsICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBpbnZva2VBUEk6IEFQSSBpbnZva2VkOiBodHRwX2Vycm9yJywgaHR0cF9lcnJvcikKICAgIG5neC5sb2cobG9nTGV2ZWwsICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBpbnZva2VBUEk6IEFQSSBpbnZva2VkOiBqc29uX2JvZHknLCBqc29uX2JvZHkpCiAgICAKICAgIHJldHVybiBodHRwX3N0YXR1c19jb2RlLCBodHRwX2Vycm9yLCBqc29uX2JvZHk7CmVuZAoKLS0gaW5pdGlhbGl6ZSBwb2xpY3kgY29uZmlndXJhdGlvbgoKZnVuY3Rpb24gX00ubmV3KGNvbmZpZykKCiAgICBuZ3gubG9nKERFQlVHLCAnaW5pdGlhbGl6aW5nIGNvbmZpZ3VyYXRpb24uLi4uICcpCiAgICBsb2NhbCBzZWxmID0gbmV3KGNvbmZpZykKCiAgICBzZWxmLmNvbmZpZyA9IGNvbmZpZyBvciB7fQoKICAgIC0tIHZhbGlkYXRpb24gc2VydmljZSBjb25maWd1cmF0aW9uIHBhcmFtZXRlcnMgCgogICAgc2VsZi52YWxpZGF0aW9uX3NlcnZpY2VfdXJsID0gY29uZmlnLnZhbGlkYXRpb25fc2VydmljZV9jb25maWd1cmF0aW9uLnZhbGlkYXRpb25fc2VydmljZV91cmwKICAgIHNlbGYudmFsaWRhdGlvbl9zZXJ2aWNlX21ldGhvZCA9IGNvbmZpZy52YWxpZGF0aW9uX3NlcnZpY2VfY29uZmlndXJhdGlvbi52YWxpZGF0aW9uX3NlcnZpY2VfbWV0aG9kIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdF92YWxpZGF0aW9uX3NlcnZpY2VfbWV0aG9kCiAgICBzZWxmLnZhbGlkYXRpb25fc2VydmljZV9wYXJhbXMgPSBjb25maWcudmFsaWRhdGlvbl9zZXJ2aWNlX2NvbmZpZ3VyYXRpb24udmFsaWRhdGlvbl9zZXJ2aWNlX3BhcmFtcyBvciB7fQoKICAgIHNlbGYuYWxsb3dlZF9zdGF0dXNfY29kZXMgPSBjb25maWcudmFsaWRhdGlvbl9zZXJ2aWNlX2NvbmZpZ3VyYXRpb24uYWxsb3dlZF9zdGF0dXNfY29kZXMgb3Ige30KICAgIC0tIHZhbGlkYXRpb24gc2VydmljZSB0aW1lb3V0cyBwYXJhbWV0ZXJzCgogICAgbG9jYWwgc2VydmljZV90aW1lb3V0cyA9IGNvbmZpZy52YWxpZGF0aW9uX3NlcnZpY2VfY29uZmlndXJhdGlvbi52YWxpZGF0aW9uX3NlcnZpY2VfdGltZW91dHMgb3Ige30KCiAgICBzZWxmLnRpbWVvdXRzID0gewogICAgICAgIGNvbm5lY3RfdGltZW91dCA9IHNlcnZpY2VfdGltZW91dHMuY29ubmVjdF90aW1lb3V0IG9yIGRlZmF1bHRfc2VydmljZV90aW1lb3V0LAogICAgICAgIHNlbmRfdGltZW91dCA9IHNlcnZpY2VfdGltZW91dHMuc2VuZF90aW1lb3V0IG9yIGRlZmF1bHRfc2VydmljZV90aW1lb3V0LAogICAgICAgIHJlYWRfdGltZW91dCA9IHNlcnZpY2VfdGltZW91dHMucmVhZF90aW1lb3V0IG9yIGRlZmF1bHRfc2VydmljZV90aW1lb3V0CiAgICB9CgogICAgLS0gYnVpbGQgdGVtcGxhdGVzIHVzZWQgYXMgc2VydmljZSBhcmd1bWVudHMKCiAgICBidWlsZF90ZW1wbGF0ZXMoc2VsZi52YWxpZGF0aW9uX3NlcnZpY2VfcGFyYW1zKQogICAgCiAgICAtLSBoZWFkZXJzIHNlY3Rpb24KCiAgICBzZWxmLmhlYWRlcnNfdG9fY29weSA9IGNvbmZpZy5oZWFkZXJzX2NvbmZpZ3VyYXRpb24uaGVhZGVyc190b19jb3B5IG9yICJBTEwiCgogICAgaWYgc2VsZi5oZWFkZXJzX3RvX2NvcHkgPT0gIlNlbGVjdGVkIEhlYWRlcnMiIHRoZW4KICAgICAgICBzZWxmLnNlbGVjdGVkX2hlYWRlcnMgPSBjb25maWcuaGVhZGVyc19jb25maWd1cmF0aW9uLnNlbGVjdGVkX2hlYWRlcnMgb3Ige30KICAgIGVsc2UKICAgICAgICBzZWxmLnNlbGVjdGVkX2hlYWRlcnMgPSB7fQogICAgZW5kCgogICAgc2VsZi5hZGRpdGlvbmFsX2hlYWRlcnMgPSBjb25maWcuaGVhZGVyc19jb25maWd1cmF0aW9uLmFkZGl0aW9uYWxfaGVhZGVycyBvciB7fQoKICAgIGJ1aWxkX3RlbXBsYXRlcyhzZWxmLmFkZGl0aW9uYWxfaGVhZGVycykKICAgIAogICAgLS0gY2FjaGluZyBzZWN0aW9uCgogICAgLS0gc2VsZi5tYXhfY2FjaGVkX3Rva2VucyA9IGNvbmZpZy5tYXhfY2FjaGVkX3Rva2VucyBvciAwCiAgICAtLSBzZWxmLmNhY2hlX2VuYWJsZWQgPSBzZWxmLm1heF9jYWNoZWRfdG9rZW5zID4gMAogICAgLS0gc2VsZi5tYXhfdHRsX3Rva2VucyA9IGNvbmZpZy5tYXhfdHRsX3Rva2VucyBvciAwCgogICAgbmd4LmxvZyhuZ3guREVCVUcsICdpbml0aWFsaXppbmcuLi4uIGVuZCAnKQogICAgCiAgICByZXR1cm4gc2VsZgplbmQKCi0tLSBmaW5kX2hlYWRlcnMgcmV0cmlldmUgdGhlIGh0dHAgaGVhZGVycyB0byBiZSBzZW50IHRvIGF1dGggcmVxdWVzdAotLS1AcGFyYW0gaGVhZGVycyB0YWJsZSBAdGhlIHJlcXVlc3QgaHR0cCBoZWFkZXJzCi0tLUBwYXJhbSBoZWFkZXJzX3RvX2NvcHkgYW55IEB0aGUgY29uZmlndXJhdGlvbiBvYmplY3QgY29udGFpbmluZyB0aGUgaGVhZGVycyB0byBiZSBmb3VuZAotLS1AcmV0dXJuIGVycm9yOiB0YWJsZSwgaGVhZGVyczogdGFibGUgQCB0aGUgMXN0IHRhYmxlIGRlc2NyaWJlcyBpZiB0aGUgbG9va3VwIGZhaWxzIGFuZCByZXR1cm4gdGhlIGNvbmZpZ3VyZWQgaHR0cCBjb2RlIGFuZCBlcnJvciAobWFuZGF0b3J5IGhlYWRlciBtaXNzaW5nIGFuZCBGYWlsIHNldCB0byB0cnVlKSB0aGUgdGFibGUgaXMgdGhlIGhlYWRlcnMgYXJyYXkKLS0tCgpsb2NhbCBmdW5jdGlvbiBmaW5kX2hlYWRlcnMoaGVhZGVycywgaGVhZGVyc190b19jb3B5KQoKICAgIG5neC5sb2coREVCVUcsICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBmaW5kX2hlYWRlcnMnKQogICAgcHJpbnRfdGFibGUoaGVhZGVycykKICAgIHByaW50X3RhYmxlKGhlYWRlcnNfdG9fY29weSkKICAgIAogICAgbG9jYWwgb3V0cHV0ID0ge30KICAgIAogICAgLS0gZmluZCB0aGUgY29uZmlndXJlZCBoZWFkZXJzICh3aGVuIHRoZSBoZWFkZXJzX3RvX2NvcHkgYXJyYXkgaW4gdGhlIGNvbmZpZ3VyYXRpb24gaXMgbm90IGVtcHR5KQoKICAgIGZvciBfLCBoZWFkZXIgaW4gaXBhaXJzKGhlYWRlcnNfdG9fY29weSkgZG8KICAgICAgICBuZ3gubG9nKERFQlVHLCAnLSBFeHRlcm5hbEF1dGhTZXJ2aWNlUG9saWN5IDogZmluZGluZyBoZWFkZXIgLT4gJywgaGVhZGVyLmhlYWRlcl9uYW1lKQoKICAgICAgICBsb2NhbCBoZWFkZXJfdG9faW5zZXJ0ID0gaGVhZGVyc1toZWFkZXIuaGVhZGVyX25hbWVdIG9yIG5pbAoKICAgICAgICBpZiBoZWFkZXJfdG9faW5zZXJ0ID09IG5pbCB0aGVuCiAgICAgICAgICAgIAogICAgICAgICAgICAtLSBoZWFkZXIgbm90IGZvdW5kLCBjaGVjayB0aGUgY29uZmlndXJlZCBiZWhhdmlvcgoKICAgICAgICAgICAgaWYgaGVhZGVyLmFjdGlvbl9pZl9taXNzaW5nID09ICdTZXQgRW1wdHknIHRoZW4KICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBvdXRwdXRbaGVhZGVyLmhlYWRlcl9uYW1lXSA9ICcnCiAgICAgICAgICAgICAgICBuZ3gubG9nKFdBUk4sICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBoZWFkZXIgJyAuLiBoZWFkZXIuaGVhZGVyX25hbWUgLi4KICAgICAgICAgICAgICAgICAgICAnIGlzIG1pc3NpbmcsIGl0IHdpbGwgYmUgcG9wdWxhdGVkIHdpdGggYW4gZW1wdHkgc3RyaW5nIGFjY29yZGluZyB0byBwb2xpY3kgY29uZmlndXJhdGlvbicpCiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlaWYgaGVhZGVyLmFjdGlvbl9pZl9taXNzaW5nID09ICdGYWlsJyB0aGVuCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbmd4LmxvZyhFUlJPUiwgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IGhlYWRlciAnIC4uIGhlYWRlci5oZWFkZXJfbmFtZSAuLgogICAgICAgICAgICAgICAgICAgICcgaXMgbWlzc2luZywgc2luY2UgaXRcJ3MgbWFuZGF0b3J5LiByZXR1cm5pbmcgYW4gZXJyb3IgdG8gdGhlIGNsaWVudC4uLicpCiAgICAgICAgICAgICAgICBsb2NhbCBlcnJvciA9IHsKICAgICAgICAgICAgICAgICAgICBodHRwX3N0YXR1cyA9IHRvbnVtYmVyKGhlYWRlci5odHRwX3N0YXR1cyBvciBkZWZhdWx0X21pc3NpbmdfaGVhZGVyX3N0YXR1cyksCiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbWVzc2FnZSA9IGhlYWRlci5tZXNzYWdlIG9yIGRlZmF1bHRfbWlzc2luZ19oZWFkZXJfbWVzc2FnZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yLCBuaWwKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBuZ3gubG9nKFdBUk4sICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBoZWFkZXIgJyAuLiBoZWFkZXIuaGVhZGVyX25hbWUgLi4KICAgICAgICAgICAgICAgICAgICAnIGlzIG1pc3NpbmcsIGl0IHdpbGwgYmUgc2tpcHBlZCcpCiAgICAgICAgICAgIAogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCgogICAgICAgICAgICBvdXRwdXRbaGVhZGVyLmhlYWRlcl9uYW1lXSA9IGhlYWRlcnNbaGVhZGVyLmhlYWRlcl9uYW1lXQogICAgICAgICAgICBuZ3gubG9nKERFQlVHLCAnLSBFeHRlcm5hbEF1dGhTZXJ2aWNlUG9saWN5IDogaGVhZGVyICcgLi4gaGVhZGVyLmhlYWRlcl9uYW1lIC4uICcgZm91bmQgd2l0aCB2YWx1ZSAnIC4uCiAgICAgICAgICAgICAgICBoZWFkZXJzW2hlYWRlci5oZWFkZXJfbmFtZV0pCgogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gbmlsLCBvdXRwdXQKZW5kCgotLS0gZnVuYyBidWlsZF9yZXF1ZXN0X2hlYWRlcnM6IGNyZWF0ZSB0aGUgaGVhZGVycyB0YWJsZSB0byBiZSBwYXNzZWQgdG8gdmFsaWRhdGlvbiBzZXJ2aWNlIGJ5IG1lcmdpbmcgdGhlIHNlbGVjdGVkIGhlYWRlcnMgYW5kIHRoZSBhZGRpdGlvbmFsCi0tLUBwYXJhbSBzZWxmIGFueSBAY3VycmVudCBtb2R1bGUgaW5zdGFuY2UgcmVwcmVzZW50YXRpb24KLS0tQHBhcmFtIGNvbnRleHQgYW55IEBjb250ZXh0IGZvciB0aGUgY3VycmVudCBjYWxsLCB1c2VkIGZvciB0ZW1wbGF0ZSBwb3B1bGF0aW9uCi0tLUBwYXJhbSBoZWFkZXJzIGFueSBAaHR0cCBoZWFkZXJzIGZvciB0aGUgaW5jb21pbmcgcmVxdWVzdAotLS1AcGFyYW0gYWRkaXRpb25hbF9oZWFkZXJzIGFueSBAaHR0cCBoZWFkZXJzIHRvIGJlIGFwcGVuZGVkIHRvIHRoZSBvdXRnb2luZyByZXF1ZXN0LCBpZiBhbnkgaGVhZGVyIGlzIGFscmVhZHkgcHJlc2VudCB3aWxsIGJlIG92ZXJyaWRkZW4KLS0tQHJldHVybiBmYWlsOiB0YWJsZSwgb3V0cHV0OnRhYmxlIEBmYWlsOiB0aGUgZXJyb3IgcmVwcmVzZW50YXRpb24sIG91dHB1dDogdGhlIGxpc3Qgb2YgdGhlIGhlYWRlcnMgdG8gYmUgdXNlZCB3aGVuIGludm9raW5nIHRoZSBhdXRoIHNlcnZpY2UKLS0tCgpsb2NhbCBmdW5jdGlvbiBidWlsZF9yZXF1ZXN0X2hlYWRlcnMoc2VsZiwgY29udGV4dCwgaGVhZGVycywgYWRkaXRpb25hbF9oZWFkZXJzKQogICAgbmd4LmxvZyhERUJVRywgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IGJ1aWxkX3JlcXVlc3RfaGVhZGVycycpCiAgICBwcmludF90YWJsZShzZWxmKQogICAgcHJpbnRfdGFibGUoY29udGV4dCkKICAgIHByaW50X3RhYmxlKGhlYWRlcnMpCiAgICBwcmludF90YWJsZShhZGRpdGlvbmFsX2hlYWRlcnMpCiAgICBsb2NhbCBvdXRwdXQKICAgIGxvY2FsIGZhaWwKICAgIAogICAgaWYgc2VsZi5oZWFkZXJzX3RvX2NvcHkgPT0gIkFMTCIgdGhlbgogICAgICAgIC0tIGNvcHkgZXZlcnkgaGVhZGVyCiAgICAgICAgbmd4LmxvZyhERUJVRywgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IGNvcHlpbmcgZXZlcnkgaGVhZGVyJykKICAgICAgICBvdXRwdXQgPSBoZWFkZXJzOwogICAgZWxzZWlmIHNlbGYuaGVhZGVyc190b19jb3B5ID09ICJTZWxlY3RlZCBIZWFkZXJzIiB0aGVuCiAgICAgICAgLS0gY29weSBzZWxlY3RlZCBoZWFkZXJzIG9ubHkKICAgICAgICBuZ3gubG9nKERFQlVHLCAnLSBFeHRlcm5hbEF1dGhTZXJ2aWNlUG9saWN5IDogY29weWluZyBvbmx5IHNlbGVjdGVkIGhlYWRlcnMnKQogICAgICAgIG5neC5sb2coREVCVUcsICdoZWFkZXJzIC0+ICcsIGhlYWRlcnMsICcgaGVhZGVyc190b19jb3B5LT4nLCBzZWxmLnNlbGVjdGVkX2hlYWRlcnMpCiAgICAgICAgZmFpbCwgb3V0cHV0ID0gZmluZF9oZWFkZXJzKGhlYWRlcnMsIHNlbGYuc2VsZWN0ZWRfaGVhZGVycykKICAgICAgICBuZ3gubG9nKERFQlVHLCAnLSBFeHRlcm5hbEF1dGhTZXJ2aWNlUG9saWN5IDogaGVhZGVyIGNvcHk6IGZhaWwgLT4nLCBmYWlsLCAnIG91dHB1dC0+Jywgb3V0cHV0KQogICAgZWxzZQogICAgICAgIC0tIGRvbid0IGNvcHkgYW55IGhlYWRlcgogICAgICAgIG5neC5sb2coREVCVUcsICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBubyBoZWFkZXJzIHdpbGwgYmUgY29waWVkJykKICAgICAgICBvdXRwdXQgPSB7fQogICAgICAgIGZhaWwgPSBuaWwKICAgIGVuZAoKICAgIGlmIChub3QgZmFpbCkgdGhlbgogICAgICAgIC0tIGFkZGluZyB0aGUgYWRkaXRpb25hbCBoZWFkZXJzIChpZiBhbnkpCiAgICAgICAgbmd4LmxvZyhERUJVRywgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IGFkZGluZyBhZGRpdGlvbmFsIGhlYWRlcnMnKQogICAgICAgIGZvciBfLCBoZWFkZXIgaW4gaXBhaXJzKGFkZGl0aW9uYWxfaGVhZGVycykgZG8KICAgICAgICAgICAgb3V0cHV0W2hlYWRlci5oZWFkZXJdID0gaGVhZGVyLnRlbXBsYXRlX3N0cmluZzpyZW5kZXIoY29udGV4dCkKICAgICAgICAgICAgbmd4LmxvZyhERUJVRywgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IGFkZGVkIHJlcXVlc3QgaGVhZGVyOiAnIC4uIGhlYWRlci5oZWFkZXIgLi4gJ3dpdGggdmFsdWUgJyAuLgogICAgICAgICAgICAgICAgb3V0cHV0W2hlYWRlci5oZWFkZXJdKQogICAgICAgIGVuZAogICAgZW5kCgogICAgcmV0dXJuIGZhaWwsIG91dHB1dAoKZW5kCgoKLS0tIGZ1bmMgYnVpbGRfcmVxdWVzdF9hcmdzIGJ1aWxkcyB0aGUgcmVxdWVzdCBhcmd1bWVudHMgYnkgcmVuZGVyaW5nIHRoZSBnaXZlbiB0ZW1wbGF0ZXMKLS0tQHBhcmFtIHNlbGYgYW55IEBjdXJyZW50IG1vZHVsZSBpbnN0YW5jZSByZXByZXNlbnRhdGlvbgotLS1AcGFyYW0gY29udGV4dCBhbnkgQGNvbnRleHQgZm9yIHRoZSBjdXJyZW50IGNhbGwsIHVzZWQgZm9yIHRlbXBsYXRlIHBvcHVsYXRpb24KLS0tQHBhcmFtIHBhcmFtcyBhbnkgQHBhcmFtcyBmb3IgdGhlIGluY29taW5nIHJlcXVlc3QgaW4gYSB0ZW1wbGF0ZSBmb3JtYXQKLS0tQHJldHVybiBvdXRwdXQ6IHRhYmxlIEB0YWJsZSBjb250YWluaW5nIHRoZSBwcm9jZXNzZWQgYXJndW1lbnRzCi0tLQoKbG9jYWwgZnVuY3Rpb24gYnVpbGRfcmVxdWVzdF9hcmdzKHNlbGYsIGNvbnRleHQsIHBhcmFtcykKICAgIG5neC5sb2coREVCVUcsICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBidWlsZF9yZXF1ZXN0X2FyZ3MnKQogICAgcHJpbnRfdGFibGUoc2VsZikKICAgIHByaW50X3RhYmxlKGNvbnRleHQpCiAgICBwcmludF90YWJsZShwYXJhbXMpCgogICAgbG9jYWwgb3V0cHV0ID0ge30KICAgIGZvciBfLCBwYXJhbSBpbiBpcGFpcnMocGFyYW1zKSBkbwogICAgICAgIG91dHB1dFtwYXJhbS5wYXJhbV0gPSBwYXJhbS50ZW1wbGF0ZV9zdHJpbmc6cmVuZGVyKGNvbnRleHQpCiAgICAgICAgbmd4LmxvZyhERUJVRywgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IGFkZGVkIHJlcXVlc3QgcGFyYW1ldGVyOiAnIC4uIHBhcmFtLnBhcmFtIC4uICd3aXRoIHZhbHVlICcgLi4KICAgICAgICAgICAgb3V0cHV0W3BhcmFtLnBhcmFtXSkKICAgIGVuZAogICAgcHJpbnRfdGFibGUob3V0cHV0KQogICAgcmV0dXJuIG91dHB1dAplbmQKCi0tLSBmdW5jdGlvbiBhY2Nlc3MKLS0tIG1haW4gcG9saWN5IG1ldGhvZDoKLS0tIC0gZXh0cmFjdCB0aGUgaGVhZGVycyBmcm9tIHRoZSBpbmNvbWluZyByZXF1ZXN0Ci0tLSAtIGJ1aWxkIHRoZSBoZWFkZXJzIGZvciB0aGUgYXV0aCBzZXJ2aWNlIHJlcXVlc3QKLS0tICAgICAtIGlmIGEgaGVhZGVyIGlzIG1pc3NpbmcgYW5kIGl0J3MgbWFuZGF0b3J5IHJldHVybnMgdGhlIGNvbmZpZ3VyZWQgSFRUUCBzdGF0dXMgY29kZSBhbmQgbWVzc2FnZQotLS0gLSBidWlsZCB0aGUgYXJndW1lbnRzIGZvciB0aGUgYXV0aCBzZXJ2aWNlIHJlcXVlc3QKLS0tIC0gaW52b2tlcyB0aGUgcmVtb3RlIHNlcnZpY2UKLS0tIC0gaWYgdGhlIHJlbW90ZSBzZXJ2aWNlIHJldHVybnMgYSAyMDAgQVBJQ2FzdCBjYW4gY29udGludWUgd2l0aCBmdXJ0aGVyIHByb2Nlc3NpbmcKLS0tIC0gaWYgdGhlIHJlbW90ZSBzZXJ2aWNlIHJldHVybnMgYSBjb2RlIGRpZmZlcmVudCB0aGFuIDIwMCBvciBhbiBlcnJvciwgQVBJQ2FzdCBleGVjdXRpb24gaXMgaW50ZXJydXB0ZWQgYW5kIHRoZSBlcnJvciBpcyByZXR1cm5lZCB0byB0aGUgY2xpZW50LgotLS1AcGFyYW0gY29udGV4dCB0YWJsZSBAaHR0cCBjb250ZXh0IGZvciB0aGUgY2FsbAotLS0KCmZ1bmN0aW9uIF9NOmFjY2Vzcyhjb250ZXh0KQogICAgbG9jYWwgaGVhZGVycwogICAgbG9jYWwgaGVhZGVyX2Vycm9yCiAgICBsb2NhbCBzZXJ2aWNlX2hlYWRlcnMKICAgIGxvY2FsIHNlcnZpY2VfYXJncwogICAgbG9jYWwgcmVzcG9uc2Vfc3RhdHVzX2NvZGUKICAgIGxvY2FsIHJlc3BvbnNlX2Vycm9yCiAgICBsb2NhbCByZXNwb25zZV9ib2R5CgogICAgbmd4LmxvZyhERUJVRywgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IHN0YXJ0JykKICAgIGhlYWRlcnMgPSBuZ3gucmVxLmdldF9oZWFkZXJzKCkgb3Ige30KCiAgICBuZ3gubG9nKERFQlVHLCAnLSBFeHRlcm5hbEF1dGhTZXJ2aWNlUG9saWN5IDogdmFsaWRhdGluZyBoZWFkZXJzJykKICAgIGhlYWRlcl9lcnJvciwgc2VydmljZV9oZWFkZXJzID0gYnVpbGRfcmVxdWVzdF9oZWFkZXJzKHNlbGYsIGNvbnRleHQsIG5neC5yZXEuZ2V0X2hlYWRlcnMoKSBvciB7fSwKICAgICAgICBzZWxmLmFkZGl0aW9uYWxfaGVhZGVycykKCiAgICBpZiBoZWFkZXJfZXJyb3IgdGhlbgogICAgICAgIG5neC5sb2coRVJST1IsICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBoZWFkZXJzIHZhbGlkYXRpb24gZmFpbGVkOiAnLCBoZWFkZXJfZXJyb3IubWVzc2FnZSkKICAgICAgICBuZ3guc3RhdHVzID0gaGVhZGVyX2Vycm9yLmh0dHBfc3RhdHVzCiAgICAgICAgbmd4LnNheShoZWFkZXJfZXJyb3IuZXJyb3JfbWVzc2FnZSkKICAgICAgICByZXR1cm4gbmd4LmV4aXQobmd4LnN0YXR1cykKICAgIGVuZAoKICAgIG5neC5sb2coREVCVUcsICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBjcmVhdGluZyByZXF1ZXN0cycpCiAgICBzZXJ2aWNlX2FyZ3MgPSBidWlsZF9yZXF1ZXN0X2FyZ3Moc2VsZiwgY29udGV4dCwgc2VsZi52YWxpZGF0aW9uX3NlcnZpY2VfcGFyYW1zKQoKICAgIG5neC5sb2coREVCVUcsICctIEV4dGVybmFsQXV0aFNlcnZpY2VQb2xpY3kgOiBpbnZva2luZyBzZXJ2aWNlJykKICAgIHJlc3BvbnNlX3N0YXR1c19jb2RlLCByZXNwb25zZV9lcnJvciwgcmVzcG9uc2VfYm9keSA9IGludm9rZVNlcnZpY2Uoc2VsZi52YWxpZGF0aW9uX3NlcnZpY2VfdXJsLCBzZXJ2aWNlX2FyZ3MsCiAgICAgICAgc2VsZi52YWxpZGF0aW9uX3NlcnZpY2VfbWV0aG9kLCBoZWFkZXJzLCBzZWxmLnRpbWVvdXRzKQogICAgbmd4LmxvZyhERUJVRywgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IGludm9rZWQgc2VydmljZSByZXNwb25zZV9zdGF0dXNfY29kZS0+ICcsIHJlc3BvbnNlX3N0YXR1c19jb2RlKQogICAgbmd4LmxvZyhERUJVRywgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IGludm9rZWQgc2VydmljZSByZXNwb25zZV9lcnJvci0+ICcsIHJlc3BvbnNlX2Vycm9yIG9yICcnKQogICAgbmd4LmxvZyhERUJVRywgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IGludm9rZWQgc2VydmljZSByZXNwb25zZV9ib2R5LT4gJywgcmVzcG9uc2VfYm9keSBvciAnJykKICAgIAogICAgaWYgKHJlc3BvbnNlX3N0YXR1c19jb2RlIH49IDIwMCkgdGhlbgogICAgICAgIGxvY2FsIHJldHVybmVkX2NvZGUKICAgICAgICBsb2NhbCByZXR1cm5lZF9tZXNzYWdlCiAgICAgICAgbmd4LmxvZyhFUlJPUiwgJy0gRXh0ZXJuYWxBdXRoU2VydmljZVBvbGljeSA6IHNlcnZpY2UgaW52b2NhdGlvbiBmYWlsZWQhIGh0dHBfc3RhdHVzOiAnLCByZXNwb25zZV9zdGF0dXNfY29kZSwKICAgICAgICAgICAgJywgcmVzcG9uc2VfZXJyb3I6ICcsIHJlc3BvbnNlX2Vycm9yIG9yICcnLCAiIHJlc3BvbnNlIGJvZHk6ICIsIHJlc3BvbnNlX2JvZHkgb3IgJycpCiAgICAgICAgCiAgICAgICAgaWYgKCNzZWxmLmFsbG93ZWRfc3RhdHVzX2NvZGVzID09IDApIG9yIGhhc192YWx1ZShzZWxmLmFsbG93ZWRfc3RhdHVzX2NvZGVzLHJlc3BvbnNlX3N0YXR1c19jb2RlKSB0aGVuCiAgICAgICAgICAgIHJldHVybmVkX2NvZGUgPSByZXNwb25zZV9zdGF0dXNfY29kZQogICAgICAgICAgICByZXR1cm5lZF9tZXNzYWdlID0gcmVzcG9uc2VfZXJyb3Igb3IgJycKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybmVkX2NvZGUgPSA1MDAKICAgICAgICAgICAgcmV0dXJuZWRfbWVzc2FnZSA9ICcnCiAgICAgICAgZW5kCgogICAgICAgIG5neC5zdGF0dXMgPSByZXR1cm5lZF9jb2RlCiAgICAgICAgbmd4LnNheShyZXR1cm5lZF9tZXNzYWdlICkKICAgICAgICByZXR1cm4gbmd4LmV4aXQobmd4LnN0YXR1cykKICAgIGVsc2UKICAgICAgICBuZ3gubG9nKERFQlVHLCAnLSBFeHRlcm5hbEF1dGhTZXJ2aWNlUG9saWN5IDogdmFsaWRhdGlvbiBzdWNjZXNzIScpCiAgICBlbmQKCmVuZAoKcmV0dXJuIF9NCg==
    init.lua: cmV0dXJuIHJlcXVpcmUoJ2V4dGVybmFsX2F1dGhfc2VydmljZScpCg==
  kind: Secret
  metadata:
    creationTimestamp: "2023-09-20T08:51:16Z"
    name: external-auth-policy
    namespace: 3scale
    resourceVersion: "258798"
    uid: e31ad1a5-2c02-4190-a64c-3bab28ec8916
  type: Opaque
kind: List
metadata:
  resourceVersion: ""
